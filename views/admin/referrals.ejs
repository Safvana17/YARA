<%- include('../../views/partials/admin/header') %>

<div class="container mt-5">
  <h2 class="mb-4">Referral Report</h2>
  <table class="table table-bordered">
    <thead class="thead-dark">
      <tr>
        <th>#</th>
        <th>Name</th>
        <th>Email</th>
        <th>Referral Code</th>
        <th>Rewarded Users</th>
        <th>Wallet Balance (₹)</th>
      </tr>
    </thead>
    <tbody>
      <% users.forEach((user, index) => { %>
        <tr>
          <td><%= index + 1 %></td>
          <td><%= user.name %></td>
          <td><%= user.email %></td>
          <td><%= user.referalCode || '-' %></td>
          <td>
            <%= user.referredBy ? user.referredBy.name + ' (' + user.referredBy.email + ')' : '-' %>
          </td>
          <td>
            <% if (user.redeemedUsers.length > 0) { %>
              <ul>
                <% user.redeemedUsers.forEach(u => { %>
                  <li><%= u.name %> (<%= u.email %>)</li>
                <% }) %>
              </ul>
            <% } else { %>
              -
            <% } %>
          </td>
          <td>₹<%= user.wallet %></td>
        </tr>
      <% }) %>
    </tbody>
  </table>
  <% if(totalPages > 1) { %>
    <nav>
      <ul class="pagination justify-content-center">
           <% for(let i=1; i<= totalPages; i++) { %>
            <li class="page-item <%= i === currentPage ? 'Active' : '' %>">
              <a href="/admin/referrals?page=<%= i %>&search=<%= search %>" class="page-link"><%= i %></a>
            </li>
           <% } %>
      </ul>
    </nav>
  <% } %>
</div>

<%- include('../../views/partials/admin/footer') %>
